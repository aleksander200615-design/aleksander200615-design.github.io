<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebGazer для физиологии</title>
    <script src="https://cdn.jsdelivr.net/npm/webgazer@3/dist/webgazer.js"></script>[web:11]
    <style>
        body { font-family: Arial; text-align: center; }
        #status { margin: 20px; font-size: 18px; }
        button { padding: 10px 20px; font-size: 16px; margin: 10px; }
        canvas { position: fixed; top: 0; left: 0; pointer-events: none; }
    </style>
</head>
<body>
    <h1>Проект по физиологии: Трекинг взгляда</h1>
    <div id="status">Статус: Готов к запуску. Нажми "Запустить"</div>
    <br>
    <button onclick="startWebGazer()">Запустить WebGazer</button>
    <button onclick="pauseWebGazer()">Пауза</button>
    <button onclick="resumeWebGazer()">Продолжить</button>
    <button onclick="endWebGazer()">Остановить</button>
    <br><br>
    <p>Кликай по экрану для калибровки (смотри на курсор). Данные взгляда в консоли (F12).</p>

    <script>
        let isReady = false;

        function showStatus(msg) {
            document.getElementById('status').innerHTML = `Статус: ${msg}`;
        }

        function startWebGazer() {
            showStatus('Запуск... Разреши доступ к камере и кликай для калибровки');
            webgazer.setGazeListener(function(data, timestamp) {
                if (data == null) return;
                const x = data.x;
                const y = data.y;
                console.log(`Взгляд: x=${Math.round(x)}, y=${Math.round(y)}, время=${timestamp}`);
                // Здесь добавь код для записи данных в файл/сервер для физиологии
            }).begin()
            .then(() => {
                showStatus('Работает! Кликай для калибровки.');
                isReady = true;
            })
            .catch(err => {
                showStatus('Ошибка: ' + err);
                console.error(err);
            });
            
            webgazer.showPredictionPoints(true); // Показывает точки предсказания
        }

        function pauseWebGazer() {
            webgazer.pause();
            showStatus('На паузе');
        }

        function resumeWebGazer() {
            webgazer.resume();
            showStatus('Продолжено');
        }

        function endWebGazer() {
            webgazer.end();
            showStatus('Остановлено');
            isReady = false;
        }

        // Проверка готовности
        setInterval(() => {
            if (webgazer.isReady() && !isReady) {
                showStatus('Готов! Данные в консоли.');
            }
        }, 1000);
    </script>
</body>
</html>
